(function(a,b){if('function'==typeof define&&define.amd)define(['exports','react','string-similarity','whatkey','lodash.isequal','../args','../utils','./types','./Bar','./Content','./Tabs'],b);else if('undefined'!=typeof exports)b(exports,require('react'),require('string-similarity'),require('whatkey'),require('lodash.isequal'),require('../args'),require('../utils'),require('./types'),require('./Bar'),require('./Content'),require('./Tabs'));else{var c={exports:{}};b(c.exports,a.React,a.stringSimilarity,a.whatkey,a.lodash,a.args,a.utils,a.types,a.Bar,a.Content,a.Tabs),a.Terminal=c.exports}})(this,function(a,b,c,d,e,f,g,h,i,j,k){'use strict';function l(a){return a&&a.__esModule?a:{default:a}}function m(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function n(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function o(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function p(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function q(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(a){var b=0|16*Math.random(),c='x'===a?b:8|3&b;return c.toString(16)})}function s(a,b){return Object.keys(b).forEach(function(c){var d=c.toLowerCase().replace(/\s/g,'').split(',');d.forEach(function(d){d===H&&(a=G({},a,b[c]))})}),a}function t(a){var b={};return Object.keys(a).forEach(function(c){var d=!1,e=a[c],f=e,g=function(a){return a};if('object'===('undefined'==typeof e?'undefined':F(e))){var h=new A.default;if('undefined'!=typeof e.options)try{h.options(e.options)}catch(a){throw new Error('options for command wrong format')}g=function(a){return h.parse(a,{name:c,help:!0,version:!1})},f=e.method,d=e.needsInstance||!1}b[c]={parse:g,method:f,needsInstance:d}}),b}Object.defineProperty(a,'__esModule',{value:!0});var u,v,w=l(b),x=l(c),y=l(d),z=l(e),A=l(f),B=l(i),C=l(j),D=l(k),E=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),F='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},G=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},H=(0,g.getOs)(),I=(v=u=function(a){function b(a){o(this,b);var c=p(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.componentWillMount=function(){c.loadPlugins(),c.assembleCommands(),c.setDescriptions(),c.setShortcuts(),c.createTab(),c.setState({prompt:c.props.promptSymbol})},c.componentDidMount=function(){c.props.watchConsoleLogging&&c.watchConsoleLogging()},c.createTab=function(){var a=c.props,b=a.color,d=a.backgroundColor,e=a.prompt,f=a.allowTabs;if(f){var g=c.state.tabs,h=r();g.push(w.default.createElement(C.default,{key:h,id:h,prompt:{color:e},inputStyles:{backgroundColor:d,color:b},handleChange:c.handleChange,handlerKeyPress:c.handlerKeyPress,backgroundColor:{backgroundColor:d},register:function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c.registerInstance.apply(c,[h].concat(b))}})),c.setState({activeTab:h,tabs:g})}},c.removeTab=function(a){var b=c.state.tabs;b.splice(a,1),c.setState({tabs:b})},c.getAppContent=function(){var a=c.state,b=a.show,d=a.minimise;return b?d?c.getBar():c.getContent():c.getNote()},c.getContent=function(){var a=c.props,b=a.color,d=a.style,e=a.barColor,f=a.showActions,g=a.hideTopBar,h=a.allowTabs,i=a.actionHandlers,j=c.state,k=j.activeTab,l=j.tabs;return w.default.createElement('div',{className:'terminal-container-wrapper',style:G({color:b},d)},!g&&w.default.createElement(B.default,G({showActions:f,style:{backgroundColor:e}},i)),h&&w.default.createElement(D.default,{active:k,setActiveTab:c.setActiveTab,createTab:c.createTab,removeTab:c.removeTab}),l)},c.getBar=function(){var a=c.props,b=a.color,d=a.barColor,e=a.style,f=a.showActions,g=a.actionHandlers;return w.default.createElement('div',{className:'terminal-container-wrapper',style:G({color:b},e)},w.default.createElement(B.default,G({showActions:f,style:{backgroundColor:d}},g)))},c.getNote=function(){return w.default.createElement('span',{className:'terminal-note'},w.default.createElement('h1',null,'OOPS! You closed the window.'),w.default.createElement('img',{src:'https://camo.githubusercontent.com/95ad3fffa11193f85dedbf14ca67e4c5c07182d0/687474703a2f2f69636f6e732e69636f6e617263686976652e636f6d2f69636f6e732f70616f6d656469612f736d616c6c2d6e2d666c61742f313032342f7465726d696e616c2d69636f6e2e706e67',width:'200',height:'200',alt:'note',onClick:c.toggleState('show')}),'Click on the icon to reopen.')},c.getPluginData=function(a){return c.pluginData[a]},c.setPluginData=function(a,b){return c.pluginData[a]=b},c.setDescriptions=function(){var a=G({},c.defaultDesciptions,c.props.descriptions);c.props.plugins.forEach(function(b){b.descriptions&&(a=G({},a,b.descriptions))}),c.setState({descriptions:a})},c.setShortcuts=function(){var a=s({},c.defaultShortcuts);a=s(a,c.props.shortcuts),c.setState({shortcuts:a})},c.setPromptPrefix=function(a,b){a.setState({promptPrefix:b})},c.setActiveTab=function(a){c.setState({activeTab:a})},c.setFalse=function(a){return function(){return c.setState(n({},a,!1))}},c.setTrue=function(a){return function(){return c.setState(n({},a,!0))}},c.setValueWithHistory=function(a,b,c){var d=a.state.history;d[b]&&(a.setState({historyCounter:b}),c.value=d[b])},c.registerInstance=function(a,b){var d=c.state.instances,e={},f={},g=d.find(function(b){return b.index===a});c.props.plugins.forEach(function(a){try{var d,h={printLine:c.printLine.bind(c,b),runCommand:c.runCommand.bind(c,b),setPromptPrefix:c.setPromptPrefix.bind(c,b),getPluginMethod:c.getPluginMethod.bind(c,b),getData:function(){return c.getPluginData(a.displayName)},setData:function(b){return c.setPluginData(a.displayName,b)}};g?g.pluginInstances[a.displayName].updateApi(h):(d=new a(h),f[a.displayName]=G({},d.getPublicMethods(),{_getName:function(){return a.displayName},_getVersion:function(){return a.version}})),e[a.displayName]=d}catch(b){console.error('Error instantiating plugin '+a.displayName,b)}});var h={index:a,instance:b,pluginMethods:g?g.pluginMethods:f,pluginInstances:g?g.pluginInstances:e};if(g){var i=d.indexOf(g);d[i]=h}else d.push(h);return c.setState({instances:d}),function(){var a=c.state.instances;c.setState({instances:a.filter(function(a){return!(0,z.default)(a.instance,b)})})}},c.toggleState=function(a){return function(){return c.setState(n({},a,!c.state[a]))}},c.assembleCommands=function(){var a=G({},c.defaultCommands,c.props.commands);c.props.plugins.forEach(function(b){b.commands&&(a=G({},a,b.commands))}),c.setState({commands:t(a)})},c.autocompleteValue=function(a){var b=c.state.descriptions,d=Object.keys(b).filter(function(a){return!1!==b[a]}),e=x.default.findBestMatch(a.value,d),f=e.bestMatch;return 0.5<=f.rating?f.target:a.value},c.clearScreen=function(a,b,c,d){d.setState({summary:[]})},c.checkShortcuts=function(a,b,d){var e=Object.keys(c.state.shortcuts);if(0<e.length){var f=a.state.keyInputs,g=b;'meta'===b&&(g='darwin'===H?'cmd':'win'===H?'win':'meta'),f.push(g);var h=f.length,i=e.map(function(a,b){return[a.replace(/\s/g,'').split('+'),b]}).filter(function(a){return a[0].length>=f.length}).filter(function(a){return(0,z.default)(a[0].slice(0,h),f)});if(!(0<i.length))0<f.length&&a.setState({keyInputs:[]});else if(1===i.length&&i[0][0].length===h){var j=e[i[0][1]],k=c.state.shortcuts[j];'string'==typeof k?c.runCommand(a,c.state.shortcuts[j]):'function'==typeof k&&(d.preventDefault(),d.stopPropagation(),k()),a.setState({keyInputs:[]})}}},c.editLine=function(a,b,c,d){var e=d.state.summary,f=a.line;-1===f&&(f=0===e.length?0:e.length-1),e[f]=a._.join(' '),d.setState({summary:e})},c.handleChange=function(a,b){var d=a.state,e=d.input,f=d.promptPrefix,g=d.history;if('Enter'===b.key&&!b.shiftKey){'undefined'==typeof b.dontShowCommand&&c.printLine.bind(c,a)(''+f+c.state.prompt+' '+b.target.value,!1);var h=c.runCommand(a,''+e.join('\n')+(0<e.length?'\n':'')+b.target.value);'undefined'!=typeof h&&c.printLine.bind(c,a)(h);var i=[].concat(m(g),[b.target.value]);a.setState({input:[],history:i,historyCounter:i.length}),b.target.value=''}else if('Enter'===b.key&&b.shiftKey){c.printLine.bind(c,a)(''+f+c.state.prompt+' '+b.target.value,!1);var j=[].concat(m(g),[b.target.value]);c.setState({input:[].concat(m(e),[b.target.value]),history:j,historyCounter:j.length}),b.target.value=''}},c.handlerKeyPress=function(a,b,d){var e=(0,y.default)(b).key,f=a.state,g=f.historyCounter,h=f.keyInputs;if(0===h.length)switch(e){case'up':c.setValueWithHistory(a,g-1,d);break;case'down':c.setValueWithHistory(a,g+1,d);break;case'tab':d.value=c.autocompleteValue(d),b.preventDefault();break;default:}c.checkShortcuts(a,e,b)},c.loadPlugins=function(){var a={};c.props.plugins.forEach(function(b){try{a[b.displayName]=b.defaultData}catch(a){console.error('Error loading plugin '+b.displayName,a)}}),c.pluginData=a},c.getPluginMethod=function(a,b,d){var e=c.state.instances.find(function(b){return(0,z.default)(b.instance,a)});if(e)if(e.pluginMethods[b]){if(e.pluginMethods[b][d])return e.pluginMethods[b][d];throw new Error('No method with name '+b+' has been registered for plugin '+b)}else throw new Error('No plugin with name '+b+' has been registered');return null},c.printLine=function(a,b){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,e=!0;if(d){var f=c.state.instances.find(function(b){return(0,z.default)(b.instance,a)});if(f)for(var g=f.pluginInstances,h=0;h<g.length;h+=1)try{e=g[h].readStdOut(b)}catch(a){}}if(!1!==e){var i=a.state.summary;i.push(b),a.setState({summary:i})}},c.runCommand=function(a,b){var d=b.split(' '),e=d[0],f=c.state.instances.find(function(b){return(0,z.default)(b.instance,a)}),g=G({},c.state.commands);f&&Object.values(f.pluginInstances).forEach(function(a){g=G({},g,t(a.commands))});var h,i=g[e];if(''===e);else if(void 0===i)'function'==typeof c.props.commandPassThrough?h=c.props.commandPassThrough(d,c.printLine.bind(c,a),c.runCommand.bind(c,a)):c.printLine.bind(c,a)('-bash:'+e+': command not found');else{var j=i.parse(d),k='undefined'==typeof j?'undefined':F(j);'object'===k&&('object'!==k||j.help)||(h=i.method(j,c.printLine.bind(c,a),c.runCommand.bind(c,a),!0===i.needsInstance?a:void 0))}return h},c.printToActive=function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];var e=c.state.instances.find(function(a){return a.index===c.state.activeTab});e&&null!==e.instance&&c.printLine.apply(c,[e.instance].concat(b))},c.watchConsoleLogging=function(){(0,g.handleLogging)('log',c.printToActive),(0,g.handleLogging)('info',c.printToActive)},c.showHelp=function(a,b,d,e){var f=G({},c.state.commands),g=G({},c.state.descriptions),h=c.state.instances.find(function(a){return(0,z.default)(a.instance,e)});h&&Object.values(h.pluginInstances).forEach(function(a){f=G({},f,a.commands),g=G({},g,a.descriptions)});var i=Object.keys(f),j=!0,k=!1,l=void 0;try{for(var m,n,o=i[Symbol.iterator]();!(j=(m=o.next()).done);j=!0)n=m.value,!1!==g[n]&&b(n+' - '+g[n])}catch(a){k=!0,l=a}finally{try{!j&&o.return&&o.return()}finally{if(k)throw l}}},c.showMsg=function(a,b){c.props.msg&&0<c.props.msg.length&&b(c.props.msg)},c.pluginData={},c.defaultCommands={show:c.showMsg,clear:{method:c.clearScreen,needsInstance:!0},help:{method:c.showHelp,needsInstance:!0},echo:function(a){return a.slice(1).join(' ')},"edit-line":{method:c.editLine,needsInstance:!0,options:[{name:'line',description:'the line you want to edit. -1 is the last line',init:function(a){return parseInt(a,10)},defaultValue:-1}]}},c.defaultDesciptions={show:'show the msg',clear:'clear the screen',help:'list all the commands',echo:'output the input',"edit-line":'edit the contents of an output line'},c.defaultShortcuts={"win, linux, darwin":{"alt + t":c.createTab},"win, linux":{"ctrl + l":'clear'},darwin:{"cmd + k":'clear'}},c.state={prompt:'>',commands:{},descriptions:{},show:'closed'!==a.startState,minimise:'minimised'===a.startState,maximise:'maximised'===a.startState,shortcuts:{},activeTab:'',tabs:[],instances:[]},c}return q(b,a),E(b,[{key:'getChildContext',value:function(){return{instances:this.state.instances,symbol:this.state.prompt,show:this.state.show,minimise:this.state.minimise,maximise:this.state.maximise,activeTab:this.state.activeTab,barShowing:!this.props.hideTopBar,tabsShowing:this.props.allowTabs,openWindow:this.setTrue('show'),closeWindow:this.setFalse('show'),minimiseWindow:this.setTrue('minimise'),unminimiseWindow:this.setFalse('minimise'),maximiseWindow:this.setTrue('maximise'),unmaximiseWindow:this.setFalse('maximise'),toggleShow:this.toggleState('show'),toggleMaximise:this.toggleState('maximise'),toggleMinimize:this.toggleState('minimise')}}},{key:'render',value:function(){return w.default.createElement('div',{className:'terminal-base',style:this.state.maximise?{maxWidth:'100%',height:'100%'}:{}},this.getAppContent())}}]),b}(b.Component),u.displayName='Terminal',u.propTypes=h.TerminalPropTypes,u.defaultProps=h.TerminalDefaultProps,u.childContextTypes=h.TerminalContextTypes,v);a.default=I});
//# sourceMappingURL=Terminal.js.map